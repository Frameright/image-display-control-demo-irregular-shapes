<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Frameright & Image Display Control demo: Irregular image containers
    </title>
    <meta
      name="description"
      content="Not all containers are rectangles. IDC metadata can be used to fit
      image assets into any desired shape. By using IDC metadata regions,
      you can define the specific region of the image that will be
      displayed and you choose which region to show in different
      situations."
    />
    <meta
      property="og:title"
      content="Frameright & Image Display Control demo: Irregular image containers"
    />
    <meta
      property="og:description"
      content="Not all containers are rectangles. IDC metadata can be used to fit
      image assets into any desired shape. By using IDC metadata regions,
      you can define the specific region of the image that will be
      displayed and you choose which region to show in different
      situations."
    />
    <meta property="og:site_name" content="Frameright" />
    <meta property="og:locale" content="en_US" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://frameright.io" />
    <meta
      property="og:image"
      content="https://irregular-shapes-demo.frameright.io/images/OG_IrregularImagesDemo.png"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.12.0/cdn/themes/light.css"
    />
    <script
      type="module"
      src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.12.0/cdn/shoelace-autoloader.js"
    ></script>
    <style>
      :root {
        --sl-color-primary-50: var(--sl-color-indigo-50);
        --sl-color-primary-100: var(--sl-color-indigo-100);
        --sl-color-primary-200: var(--sl-color-indigo-200);
        --sl-color-primary-300: var(--sl-color-indigo-300);
        --sl-color-primary-400: var(--sl-color-indigo-400);
        --sl-color-primary-500: var(--sl-color-indigo-500);
        --sl-color-primary-600: var(--sl-color-indigo-600);
        --sl-color-primary-700: var(--sl-color-indigo-700);
        --sl-color-primary-800: var(--sl-color-indigo-800);
        --sl-color-primary-900: var(--sl-color-indigo-900);
        --sl-color-primary-950: var(--sl-color-indigo-950);
      }

      body {
        font-family: var(--sl-font-sans);
        font-size: var(--sl-font-size-small);
        color: var(--sl-color-primary-900);
      }

      #logo {
        position: fixed;
        left: 10px;
        top: 10px;
        width: 50px;
        height: auto;
      }

      h1 {
        font-size: var(--sl-font-size-2x-large);
        font-weight: var(--sl-font-weight-bold);
        margin-top: 6rem;
        margin-bottom: 0.5rem;
      }

      h2 {
        font-size: var(--sl-font-size-large);
        font-weight: var(--sl-font-weight-normal);
        margin-top: 0rem;
        margin-bottom: 2rem;
      }

      h3#power {
        margin-top: 2rem;
      }

      p {
        font-size: var(--sl-font-size-medium);
        font-weight: var(--sl-font-weight-normal);
        margin-top: 2rem;
        margin-bottom: 2rem;
        width: 100%;
      }

      main {
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        min-height: 90vh;
        min-width: 90vw;
        margin-bottom: 30px;
        margin-left: auto;
        margin-right: auto;
      }

      .image-container {
        position: relative;
        aspect-ratio: 16 / 10;
        max-height: 90vh;
        max-width: 1200px;
        margin-left: auto;
        margin-right: auto;
        display: flex;
        flex-wrap: nowrap;
        margin-bottom: 2rem;
        box-shadow: 0px 0px 20px 10px var(--sl-color-gray-200);
        border: 10px solid white;
      }

      .image-container.mobile {
        aspect-ratio: 177 / 316;
        max-height: 60vh;
        max-width: 400px;
      }

      .image-container div {
        position: absolute;
        width: 58.8%;
        height: 100%;
      }

      .image-container.mobile div {
        width: 86%;
      }

      .image-container div:nth-child(1) {
        left: 0;
        clip-path: polygon(0% 0%, 99% 0%, 70% 100%, 0% 100%);
      }

      .image-container div:nth-child(2) {
        right: 0;
        clip-path: polygon(30% 0%, 100% 0%, 100% 100%, 1% 100%);
      }

      .image-container.mobile div:nth-child(1) {
        clip-path: polygon(0% 0%, 99% 0%, 16% 100%, 0% 100%);
      }

      .image-container.mobile div:nth-child(2) {
        clip-path: polygon(84% 0%, 100% 0%, 100% 100%, 1% 100%);
      }

      .image-container img {
        object-fit: cover;
        width: 100%;
        height: 100%;
      }

      #controls {
        width: 100%;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
      }

      @media (max-width: 768px) {
        #controls {
          justify-content: left;
        }
      }

      sl-switch {
        margin-right: 1rem;
        margin-top: 0.5rem;
        margin-bottom: 1rem;
      }

      sl-button {
        margin-top: 0.5rem;
        margin-bottom: 1rem;
      }

      .text {
        max-width: 800px;
        width: 80%;
        margin-top: 3rem;
        margin-left: auto;
        margin-right: auto;
        text-align: left;
      }

      ul,
      ol {
        font-size: var(--sl-font-size-medium);
        margin-top: 2rem;
        margin-bottom: 2rem;
        width: 80%;
      }
      li {
        margin-top: 1rem;
        margin-bottom: 1rem;
      }
    </style>
  </head>

  <body>
    <a href="https://frameright.io">
      <img id="logo" src="images/frameright.svg" alt="" />
    </a>

    <main>
      <section>
        <h1>Irregular image containers</h1>
        <h2>
          <a href="https://frameright.io">Frameright</a> &
          <a href="https://frameright.io/idc">Image Display Control</a> demo
        </h2>

        <div class="image-container">
          <div>
            <img
              is="image-display-control"
              data-region-definition-name-desktop="Desktop Left"
              data-region-definition-name-mobile="Mobile Left"
              data-original-src="images/DemoLeft_2016_SkateDeconstruct_copyright_marinaekroo_sRGBU3C5242.jpg"
              src="images/DemoLeft_2016_SkateDeconstruct_copyright_marinaekroo_sRGBU3C5242.jpg"
              data-image-region-id=""
              alt=""
            />
          </div>
          <div>
            <img
              is="image-display-control"
              data-region-definition-name-desktop="Desktop Right"
              data-region-definition-name-mobile="Mobile Right"
              data-original-src="images/DemoRight_2016_SkateDeconstruct_copyright_marinaekroos_U3C29942016.jpg"
              src="images/DemoRight_2016_SkateDeconstruct_copyright_marinaekroos_U3C29942016.jpg"
              alt=""
            />
          </div>
        </div>
        <div id="controls">
          <sl-switch
            id="idc"
            checked
            size="medium"
            style="---width: 20px; --height: 30px; --thumb-size: 26px"
          >
            Image Display Control
          </sl-switch>
          <sl-switch
            id="ratio"
            size="medium"
            style="---width: 20px; --height: 30px; --thumb-size: 26px"
          >
            Mobile view </sl-switch
          ><br />
          <sl-button id="reset" variant="default" pill>
            <sl-icon slot="suffix" name="arrow-counterclockwise"></sl-icon>
            Reset
          </sl-button>
        </div>
        <div class="text">
          <h3>
            This demo shows how you can combine Image Display Control with
            irregularly shaped image containers.
          </h3>
          <p>
            <i
              >The demo is intended for modern browsers. See our
              <a href="https://docs.frameright.io">Developer portal</a> for
              polyfills for older browsers.</i
            >
          </p>
          <p>
            Not all containers are rectangles. IDC metadata can be used to fit
            image assets into any desired shape. By using IDC metadata regions,
            you can define the specific region of the image that will be
            displayed and you choose which region to show in different
            situations. You can define as many regions as needed.
          </p>
          <p>
            Toggle between the IDC and mobile view buttons to see how the image
            behaves with and without the IDC metadata. You can also test it with
            your own images by following the steps below:
          </p>
          <ol>
            <li>
              Open an image file in
              <a href="https://frameright.app">Frameright</a>.
            </li>
            <li>
              Use the irregular shapes definitions:
              <i>
                Common sizes > Frameright Demo > Irregular Desktop/Mobile
                Left/Right.</i
              >
            </li>
            <li>Save the file.</li>
            <li>
              Locate the file in your downloads folder and drag and drop it onto
              the left or right image area.
            </li>
          </ol>
          <h3>Learn more</h3>
          <ul>
            <li>
              Demo
              <a
                href="https://github.com/Frameright/image-display-control-demo-irregular-shapes"
                >source code</a
              >
              is available on GitHub
            </li>
            <li>
              Documentation for IDC open-source components and libraries is
              available on the
              <a href="https://docs.frameright.io/"
                >Frameright developer portal</a
              >
            </li>
            <li>
              Learn more about about
              <a href="https://www.frameright.io/">Frameright</a> and
              <a href="https://www.frameright.io/idc">Image Display Control</a>
            </li>
          </ul>
          <h3 id="power">
            <b><i>Power to the pictures!</i></b>
          </h3>
        </div>
      </section>
    </main>

    <!-- Polyfill for Safari, see https://github.com/ungap/custom-elements -->
    <script src="https://unpkg.com/@ungap/custom-elements/es.js"></script>
    <script type="module">
      import { ResizeObserver } from "https://cdn.pika.dev/@juggle/resize-observer/^3.0.2";
      window.ResizeObserver = ResizeObserver;
    </script>

    <script
      type="module"
      src="https://cdn.jsdelivr.net/npm/@frameright/image-display-control-web-component@1.1.8/dist/image-display-control.min.js"
    ></script>
    <script
      type="module"
      src="https://cdn.jsdelivr.net/npm/@frameright/image-display-control-metadata-parser@1.2.0/dist/image-display-control-metadata-parser-standalone.min.js"
    ></script>

    <script type="text/javascript">
      async function handleIdcMetadata(element) {
        const image = await fetch(element.src, {
          cache: "force-cache"
        });
        const arrayBuffer = await image.arrayBuffer();
        const buffer = Buffer.Buffer.from(arrayBuffer);
        const parser = new ImageDisplayControl.Parser(buffer);
        const regions = parser.getIdcMetadata("rectangle", "crop");
        updatePreferredRegion(element, regions);
        element.dataset.imageRegions = JSON.stringify(regions);
      }

      function updatePreferredRegion(element, regions) {
        // Find if we want desktop or mobile region definition
        const preferredRegionDefinition = document.querySelector("#ratio")
          .checked
          ? element.dataset.regionDefinitionNameMobile
          : element.dataset.regionDefinitionNameDesktop;
        // Find region with preferred region definition name and update the
        // image region id data attribute with the preferred region id.
        // For the demo we accept the first region that includes "Desktop Left" or "Desktop Right"
        // or "Mobile Left" or "Mobile Right", depending on the image container.
        const preferredRegion = regions.find((region) =>
          region.idcRegionDefinitionName.includes(preferredRegionDefinition)
        );
        element.dataset.imageRegionId = preferredRegion
          ? preferredRegion.id
          : "";
      }

      document.addEventListener("DOMContentLoaded", (event) =>
        document
          .querySelectorAll('img[is="image-display-control"]')
          .forEach(handleIdcMetadata)
      );

      ["dragenter", "dragover", "drop"].forEach((eventType) => {
        document.addEventListener(eventType, (event) => {
          event.preventDefault();
        });
      });

      document.querySelectorAll(".image-container img").forEach((element) =>
        element.addEventListener("dragover", (event) => {
          event.target.style.opacity = "0.5";
        })
      );

      ["dragend", "dragleave", "drop"].forEach((eventType) =>
        document.querySelectorAll(".image-container img").forEach((element) =>
          element.addEventListener(eventType, (event) => {
            event.target.style.opacity = "1";
          })
        )
      );

      document.querySelectorAll(".image-container img").forEach((element) =>
        element.addEventListener("drop", (event) => {
          event.preventDefault();
          [...event.dataTransfer.files]
            // Only accept max 1 image file. Filter & slice others away.
            .filter((file) => ["image/jpeg", "image/png"].includes(file.type))
            .slice(0, 1)
            .forEach((file) => {
              const reader = new FileReader();
              reader.onload = function (event) {
                element.onload = () => handleIdcMetadata(element);
                // Clean up old uploaded image
                URL.revokeObjectURL(element.src);
                element.src = URL.createObjectURL(file);
              };
              reader.readAsDataURL(file);
            });
        })
      );

      document.querySelector("#idc").addEventListener("sl-change", (event) =>
        document
          .querySelectorAll('img[is="image-display-control"]')
          .forEach((imgElement) => {
            imgElement.dataset.disabled = event.target.checked ? "none" : "all";
          })
      );

      document
        .querySelector("#ratio")
        .addEventListener("sl-change", (event) => {
          document.querySelector(".image-container").classList.toggle("mobile");
          document
            .querySelectorAll('img[is="image-display-control"]')
            .forEach((imgElement) => {
              // Container has changed in size, so we need to update the
              // preferred region
              updatePreferredRegion(
                imgElement,
                JSON.parse(imgElement.dataset.imageRegions)
              );
            });
        });

      document.querySelector("#reset").addEventListener("click", (event) => {
        document.querySelector(".image-container").classList.remove("mobile");
        document.querySelector("#ratio").checked = false;
        document.querySelector("#idc").checked = true;
        document
          .querySelectorAll('img[is="image-display-control"]')
          .forEach((imgElement) => {
            // Clean up old uploaded image
            URL.revokeObjectURL(imgElement.src);
            // Retrigger IDC metadata parsing
            imgElement.onload = () => handleIdcMetadata(imgElement);
            imgElement.src = imgElement.dataset.originalSrc;
            imgElement.dataset.disabled = "none";
          });
      });
    </script>
  </body>
</html>
